"use strict";(self.webpackChunkrke_docs=self.webpackChunkrke_docs||[]).push([[9806],{578:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>i,contentTitle:()=>o,default:()=>u,frontMatter:()=>t,metadata:()=>c,toc:()=>l});var s=a(5893),r=a(1151);const t={title:"AWS Cloud Provider"},o=void 0,c={id:"config-options/cloud-providers/aws/aws",title:"AWS Cloud Provider",description:"To enable the AWS cloud provider, there are no RKE configuration options. You only need to set the name as aws. In order to use the AWS cloud provider, all cluster nodes must have already been configured with an appropriate IAM role and your AWS resources must be tagged with a cluster ID.",source:"@site/docs/config-options/cloud-providers/aws/aws.md",sourceDirName:"config-options/cloud-providers/aws",slug:"/config-options/cloud-providers/aws/",permalink:"/config-options/cloud-providers/aws/",draft:!1,unlisted:!1,editUrl:"https://github.com/rancher/rke1-docs/edit/main/docs/config-options/cloud-providers/aws/aws.md",tags:[],version:"current",lastUpdatedAt:1700871694,formattedLastUpdatedAt:"Nov 25, 2023",frontMatter:{title:"AWS Cloud Provider"},sidebar:"mySidebar",previous:{title:"Cloud Providers",permalink:"/config-options/cloud-providers/"},next:{title:"Azure Cloud Provider",permalink:"/config-options/cloud-providers/azure/"}},i={},l=[{value:"IAM Requirements",id:"iam-requirements",level:2},{value:"Tagging AWS Resources",id:"tagging-aws-resources",level:2},{value:"Tagging for Load Balancers",id:"tagging-for-load-balancers",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["To enable the AWS cloud provider, there are no RKE configuration options. You only need to set the name as ",(0,s.jsx)(n.code,{children:"aws"}),". In order to use the AWS cloud provider, all cluster nodes must have already been configured with an ",(0,s.jsx)(n.a,{href:"#iam-requirements",children:"appropriate IAM role"})," and your AWS resources must be ",(0,s.jsx)(n.a,{href:"#tagging-aws-resources",children:"tagged with a cluster ID"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"cloud_provider:\n    name: aws\n"})}),"\n",(0,s.jsx)(n.h2,{id:"iam-requirements",children:"IAM Requirements"}),"\n",(0,s.jsxs)(n.p,{children:["In a cluster with the AWS cloud provider enabled, nodes must have at least the ",(0,s.jsx)(n.code,{children:"ec2:Describe*"})," action."]}),"\n",(0,s.jsx)(n.p,{children:"In order to use Elastic Load Balancers (ELBs) and EBS volumes with Kubernetes, the node(s) will need to have the an IAM role with appropriate permissions."}),"\n",(0,s.jsxs)(n.p,{children:["IAM policy for nodes with the ",(0,s.jsx)(n.code,{children:"controlplane"})," role:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Effect": "Allow",\n      "Action": [\n        "autoscaling:DescribeAutoScalingGroups",\n        "autoscaling:DescribeLaunchConfigurations",\n        "autoscaling:DescribeTags",\n        "ec2:DescribeInstances",\n        "ec2:DescribeRegions",\n        "ec2:DescribeRouteTables",\n        "ec2:DescribeSecurityGroups",\n        "ec2:DescribeSubnets",\n        "ec2:DescribeVolumes",\n        "ec2:CreateSecurityGroup",\n        "ec2:CreateTags",\n        "ec2:CreateVolume",\n        "ec2:ModifyInstanceAttribute",\n        "ec2:ModifyVolume",\n        "ec2:AttachVolume",\n        "ec2:AuthorizeSecurityGroupIngress",\n        "ec2:CreateRoute",\n        "ec2:DeleteRoute",\n        "ec2:DeleteSecurityGroup",\n        "ec2:DeleteVolume",\n        "ec2:DetachVolume",\n        "ec2:RevokeSecurityGroupIngress",\n        "ec2:DescribeVpcs",\n        "elasticloadbalancing:AddTags",\n        "elasticloadbalancing:AttachLoadBalancerToSubnets",\n        "elasticloadbalancing:ApplySecurityGroupsToLoadBalancer",\n        "elasticloadbalancing:CreateLoadBalancer",\n        "elasticloadbalancing:CreateLoadBalancerPolicy",\n        "elasticloadbalancing:CreateLoadBalancerListeners",\n        "elasticloadbalancing:ConfigureHealthCheck",\n        "elasticloadbalancing:DeleteLoadBalancer",\n        "elasticloadbalancing:DeleteLoadBalancerListeners",\n        "elasticloadbalancing:DescribeLoadBalancers",\n        "elasticloadbalancing:DescribeLoadBalancerAttributes",\n        "elasticloadbalancing:DetachLoadBalancerFromSubnets",\n        "elasticloadbalancing:DeregisterInstancesFromLoadBalancer",\n        "elasticloadbalancing:ModifyLoadBalancerAttributes",\n        "elasticloadbalancing:RegisterInstancesWithLoadBalancer",\n        "elasticloadbalancing:SetLoadBalancerPoliciesForBackendServer",\n        "elasticloadbalancing:AddTags",\n        "elasticloadbalancing:CreateListener",\n        "elasticloadbalancing:CreateTargetGroup",\n        "elasticloadbalancing:DeleteListener",\n        "elasticloadbalancing:DeleteTargetGroup",\n        "elasticloadbalancing:DescribeListeners",\n        "elasticloadbalancing:DescribeLoadBalancerPolicies",\n        "elasticloadbalancing:DescribeTargetGroups",\n        "elasticloadbalancing:DescribeTargetHealth",\n        "elasticloadbalancing:ModifyListener",\n        "elasticloadbalancing:ModifyTargetGroup",\n        "elasticloadbalancing:RegisterTargets",\n        "elasticloadbalancing:SetLoadBalancerPoliciesOfListener",\n        "iam:CreateServiceLinkedRole",\n        "kms:DescribeKey"\n      ],\n      "Resource": [\n        "*"\n      ]\n    }\n  ]\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["IAM policy for nodes with the ",(0,s.jsx)(n.code,{children:"etcd"})," or ",(0,s.jsx)(n.code,{children:"worker"})," role:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Effect": "Allow",\n      "Action": [\n        "ec2:DescribeInstances",\n        "ec2:DescribeRegions",\n        "ecr:GetAuthorizationToken",\n        "ecr:BatchCheckLayerAvailability",\n        "ecr:GetDownloadUrlForLayer",\n        "ecr:GetRepositoryPolicy",\n        "ecr:DescribeRepositories",\n        "ecr:ListImages",\n        "ecr:BatchGetImage"\n      ],\n      "Resource": "*"\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"tagging-aws-resources",children:"Tagging AWS Resources"}),"\n",(0,s.jsx)(n.p,{children:"The AWS cloud provider uses tagging to discover and manage resources, the following resources are not automatically tagged by Kubernetes or RKE:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"VPC"}),": The VPC used by the cluster"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Subnet"}),": The subnets used by the cluster"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"EC2 instances"}),": All nodes launched for the cluster"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Security Groups"}),": The security group(s) used by nodes in the cluster"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," If creating a ",(0,s.jsx)(n.code,{children:"LoadBalancer"})," service and there is more than one security group attached to nodes, you must tag only one of the security groups as ",(0,s.jsx)(n.code,{children:"owned"})," so that Kubernetes knows which group to add and remove rules. A single untagged security group is allowed, however, sharing this between clusters is not recommended."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Using_Tags.html",children:"AWS Documentation: Tagging Your Amazon EC2 Resources"})}),"\n",(0,s.jsx)(n.p,{children:"You must tag with one of the following:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Key"}),(0,s.jsx)(n.th,{children:"Value"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:["kubernetes.io/cluster/",(0,s.jsx)(n.code,{children:"<CLUSTERID>"})]}),(0,s.jsx)(n.td,{children:"shared"})]})})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"<CLUSTERID>"})," can be any string you choose. However, the same string must be used on every resource you tag. Setting the tag value to ",(0,s.jsx)(n.code,{children:"owned"})," informs the cluster that all resources tagged with the ",(0,s.jsx)(n.code,{children:"<CLUSTERID>"})," are owned and managed by this cluster only."]}),"\n",(0,s.jsx)(n.p,{children:"If you do not share resources between clusters, you can change the tag to:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Key"}),(0,s.jsx)(n.th,{children:"Value"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:["kubernetes.io/cluster/",(0,s.jsx)(n.code,{children:"<CLUSTERID>"})]}),(0,s.jsx)(n.td,{children:"owned"})]})})]}),"\n",(0,s.jsx)(n.h2,{id:"tagging-for-load-balancers",children:"Tagging for Load Balancers"}),"\n",(0,s.jsxs)(n.p,{children:["When provisioning a ",(0,s.jsx)(n.code,{children:"LoadBalancer"})," service Kubernetes will attempt to discover the correct subnets, this is also achieved by tags and requires adding additional subnet tags to ensure internet-facing and internal ELBs are created in the correct subnets."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/load-balancing.html#subnet-tagging-for-load-balancers",children:"AWS Documentation: Subnet tagging for load balancers"})})]})}function u(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},1151:(e,n,a)=>{a.d(n,{Z:()=>c,a:()=>o});var s=a(7294);const r={},t=s.createContext(r);function o(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);